const data = [
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [1.1, 1.29, 1.56, 1.65, 1.7, 1.78, 1.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.04, 2.09, 2.6, 2.8, 2.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.04, 2.09, 2.6, 2.8, 2.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [0.04, 0.09, 0.1, 0.35, 0.6, 0.8, 0.89],
    lvl: 1,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.082, 2.422, 2.5, 2.56],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [1.082, 1.422, 1.5, 1.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.562, 2.82, 4.62, 3.9],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [4.082, 4.422, 4.5, 4.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.082, 2.422, 2.5, 2.56],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [1.082, 1.422, 1.5, 1.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.562, 2.82, 4.62, 3.9],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [4.082, 4.422, 4.5, 4.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.082, 2.422, 2.5, 2.56],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [1.082, 1.422, 1.5, 1.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.562, 2.82, 4.62, 3.9],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [4.082, 4.422, 4.5, 4.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.082, 2.422, 2.5, 2.56],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [1.082, 1.422, 1.5, 1.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.562, 2.82, 4.62, 3.9],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [4.082, 4.422, 4.5, 4.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.082, 2.422, 2.5, 2.56],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [1.082, 1.422, 1.5, 1.59],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [2.562, 2.82, 4.62, 3.9],
    lvl: 2,
  },
  {
    question:
      "Ranger les sept nombres suivants par ordre croissant (du plus petit au plus grand)",
    correct: [4.082, 4.422, 4.5, 4.59],
    lvl: 2,
  },
];

const question = document.querySelector(".questions");
const answers = document.querySelector(".answers");
const oui = document.querySelector(".question");
const next = document.querySelector("#next").addEventListener("click", verify);

const total = localStorage.getItem("number");
const arrLvl = data
  .filter((item) => item.lvl == localStorage.getItem("lvl"))
  .slice(0, total);
let active = 0;
let trys = 0;

function tryNumber() {
  if (trys === 3) {
    window.location = "/";
  }
}

function displayResult() {
  trys += 1;
  tryNumber();
  document.querySelectorAll(".indicator").forEach((el) => {
    el.classList.add("result");
  });

  arrLvl.map((item, i) => {
    !item.test
      ? question.children[i].classList.add("striped")
      : question.children[i].classList.contains("striped")
      ? question.children[i].classList.add("completed2")
      : question.children[i].classList.add("completed");
  });

  const random = () => Math.floor(Math.random() * Math.floor(arrLvl.length));

  return (answers.innerHTML = `
       <div class="results_Content">
        <span class="total">${random() * 10}%</span>
        <span class="total_sur">${random()} sur ${arrLvl.length}</span>
        <button class="blueBtn return" id="exercice">Retour</button>
      </div>   
    `);
  /* true results*/
  // <div class="results_Content">
  //   <span class="total">
  //     ${(arrLvl.filter((el) => el.test === true).length / arrLvl.length) * 100}%
  //   </span>
  //   <span class="total_sur">
  //     ${arrLvl.filter((el) => el.test === true).length} sur ${arrLvl.length}
  //   </span>
  //   <button class="blueBtn return" id="exercice">
  //     Retour
  //   </button>
  // </div>;
}

function verify() {
  const result = document.querySelectorAll(".draggable");
  let test = [];
  result.forEach((el) => {
    test.push(parseFloat(el.innerHTML));
  });

  const correct =
    JSON.stringify(test) === JSON.stringify(arrLvl[active].correct);
  arrLvl[active].test = correct;

  completed();
  active += 1;
  answers.innerHTML = "";

  if (active === arrLvl.length) {
    question.children[active - 1].classList.remove("active");
    question.children[active - 1].classList.remove("activeTry");
    return displayResult();
  }

  renderAnwers(active);
  renderActive(active);
}

function completed() {
  const test = question.children[active].classList.contains("striped")
    ? (question.children[active].classList.add("completed2"),
      question.children[active].classList.remove("striped"))
    : question.children[active].classList.add("completed");

  return test;
}

function renderActive(activ) {
  active = activ;
  renderAnwers(active);
  document.querySelectorAll(".indicator").forEach((el) => {
    el.classList.remove("active");
    el.classList.remove("result");
    el.classList.remove("activeTry");
  });

  const test = question.children[active].classList.contains("striped")
    ? question.children[active].classList.add("activeTry")
    : question.children[active].classList.add("active");

  return test;
}

function renderAnwers(active) {
  answers.innerHTML = "";
  const shuffle = [...arrLvl[active].correct].sort(() => Math.random() - 0.5);
  const title = document.createElement("span");
  title.innerText = arrLvl[active].question;
  answers.append(title);

  shuffle.map((item, i) => {
    const el = document.createElement("div");
    el.classList.add("dropabble");
    el.innerHTML = `<div class="outer">${i + 1}</div>
        <div class="drag"><div class="draggable" value="${item}">${item}</div></div>`;
    answers.append(el);
  });
}

function renderIndicators() {
  arrLvl.map((_, i) => {
    const el = document.createElement("div");
    el.className = "indicator";
    el.setAttribute("value", i);
    el.addEventListener("click", (e) => {
      renderActive(i, e);
    });
    question.append(el);
  });
}

window.onload = () => {
  renderIndicators();
  renderAnwers(active);
  question.children[active].classList.add("active");
};
